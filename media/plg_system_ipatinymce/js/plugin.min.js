(typeof(tinymce)!=="undefined")&&tinymce.PluginManager.add("ipa",function(g,h){console.log("TinyMCE for ItaliaPA v.3.8.0.4");var s=Joomla.getOptions?Joomla.getOptions("plg_system_ipatinymce",{}):(Joomla.optionsStorage.plg_system_ipatinymce||{}),w=s.jsurl||h,l=s.cssurl||h;tinymce.DOM.loadCSS(l+"/editor.min.css");g.contentCSS.push(l+"/italiapa.min.css");g.contentCSS.push(l+"/content.min.css");var i=new tinymce.dom.ScriptLoader();i.add(w+"/uuid.min.js");i.loadQueue();var C=[];var o=function(){var F=g.selection.getNode();var D=(F.nodeName.toLowerCase()=="a")&&g.dom.hasClass(F,"Tooltip-toggle");var I="",G="",E="";if(D){I=g.dom.getAttrib(F,"href").substr(1);G=F.innerHTML;var H=g.getDoc().getElementById(I).firstChild;while(H){if(H.nodeName.toLowerCase()=="span"){E=H.innerHTML}H=H.nextSibling}}else{I="tooltip-"+uuid.v4();G=g.selection.getContent()}g.windowManager.open({title:"Tooltip",body:[{type:"textbox",name:"id",minWidth:400,label:"ID",value:I,disabled:true},{type:"textbox",name:"text",minWidth:400,label:"Text",value:G},{type:"textbox",name:"tooltip",minWidth:400,label:"Tooltip",value:E,minHeight:80,multiline:true}],onsubmit:function(M){var O=M.data.id;var N=M.data.text;var L=M.data.tooltip;var K='<span class="Icon-drop-down Dropdown-arrow u-color-teal-70"></span><span class="u-layout-prose u-text-r-xs">'+L+"</span>";if(D){F.innerHTML=N;g.getDoc().getElementById(O).innerHTML=K}else{var J='<a href="#'+O+'" class="Tooltip-toggle u-textClean u-padding-right-xs u-padding-left-xs u-background-teal-50 u-color-black" data-menu-trigger="'+O+'">'+N+'</a><span id="'+O+'" data-menu class="Dropdown-menu u-borderShadow-m u-background-teal-70 u-color-white u-layout-prose u-padding-r-all u-borderRadius-l">'+K+"</span>";g.selection.setContent(J)}}})};C.push({icon:"none icon-ipa-tooltip",text:"Tooltip",context:"insert",onclick:o});g.addButton("ipa-tooltip",{text:null,icon:"none icon-ipa-tooltip",tooltip:"Tooltip",onclick:o,stateSelector:"a.Tooltip-toggle[data-menu-trigger]"});var j=function(){var H=g.selection.getNode();var F=(H.nodeName.toLowerCase()=="button")&&g.dom.hasClass(H,"js-fr-dialogmodal-open");var D="",L="",K="",I="",M="";if(F){D=g.dom.getAttrib(H,"aria-controls");L=H.innerHTML;var E=g.getDoc().getElementById(D).firstChild.firstChild;var G=E.firstChild;if(G.nodeName.toLowerCase()==="h2"){K=G.innerHTML;G.parentNode.removeChild(G)}var J=E.lastChild;if(J.nodeName.toLowerCase()==="button"){M=J.innerHTML;J.parentNode.removeChild(J)}I=E.innerHTML}else{D="dialog-"+uuid.v4();L=g.selection.getContent()}g.windowManager.open({title:"Dialog",body:[{type:"textbox",name:"id",minWidth:400,label:"ID",value:D,disabled:true},{type:"textbox",name:"text",minWidth:400,label:"Apri",value:L},{type:"textbox",name:"title",minWidth:400,label:"Titolo",value:K},{type:"textbox",name:"dialog",minWidth:400,label:"Testo",value:I,minHeight:80,multiline:true},{type:"textbox",name:"close",minWidth:400,label:"Chiudi",value:M}],onsubmit:function(P){var U=P.data.id,S=P.data.text,R=P.data.title,N=P.data.dialog,Q=P.data.close,T='<div class="Dialog-content Dialog-content--centered u-background-white u-layout-prose u-margin-all-xl u-padding-all-xl js-fr-dialogmodal-modal" aria-labelledby="modal-title-'+U+'"><div role="document" class="Prose"><h2 class="u-cf u-text-h2 u-borderHideFocus" id="modal-title-'+U+'" tabindex="0">'+R+"</h2>"+N+(Q?'<button class="Button Button--danger js-fr-dialogmodal-close u-floatRight">'+Q+"</button>":"")+"</div></div>";if(F){H.setAttribute("aria-controls",U);H.innerHTML=S;g.getDoc().getElementById(U).innerHTML=T}else{var O='<button class="Button Button--default js-fr-dialogmodal-open" aria-controls="'+U+'">'+S+'</button><div class="Dialog js-fr-dialogmodal" id="'+U+'">'+T+"</div>";g.selection.setContent(O)}}})};C.push({icon:"none icon-out-2",text:"Dialog",context:"insert",onclick:j});g.addButton("ipa-dialog",{text:null,icon:"none icon-out-2",tooltip:"Dialog",onclick:j,stateSelector:"button.js-fr-dialogmodal-open"});function x(F){var E=g.dom.getParent(g.selection.getNode(),"div.Alert")||g.selection.getNode(),D=g.dom.hasClass(E,"Alert"),I={error:"Si &egrave; verificato un errore",warning:"Attenzione",success:"Operazione effettuata con successo",info:"Ulteriori informazioni"},H=g.selection.getContent()||F.charAt(0).toUpperCase()+F.slice(1),G=I[F];node=g.dom.create("div",{role:"alert","class":"Prose Alert Alert--"+F+" Alert--withIcon u-layout-prose u-padding-r-bottom u-padding-r-right u-margin-r-bottom"});if(D){node.innerHTML=E.innerHTML;E.parentNode.replaceChild(node,E)}else{node.innerHTML='<h2 class="u-text-h3">'+G+'</h2><p class="u-text-p">'+H+"</p>";g.selection.setContent(node.outerHTML)}}var p=[],q,e;tinymce.each(["error","warning","success","info"],function(D){if(!e){e=D}p.push({icon:"none icon-"+D,text:D.charAt(0).toUpperCase()+D.slice(1),context:"insert",onclick:function(){q=D;x(D)}})});g.addButton("ipa-alert",{icon:"none icon-alert",type:"splitbutton",title:"Alert",onclick:function(){x(q||e)},menu:p,stateSelector:"div.Alert"});C.push({icon:"none icon-alert",text:"Alert",context:"insert",onclick:function(){x(q||e)},menu:p});function b(F){var D=g.dom.getParent(g.selection.getNode(),"div.Callout")||g.selection.getNode(),E=g.dom.hasClass(D,"Callout"),I={must:"Must",should:"Should",could:"Could",example:"Example"},H=g.selection.getContent()||F.charAt(0).toUpperCase()+F.slice(1),G=I[F];node=g.dom.create("div",{role:"note","class":"Callout Callout--"+F+" u-text-r-xs"});if(E){node.innerHTML=D.innerHTML;D.parentNode.replaceChild(node,D)}else{node.innerHTML='<h2 class="Callout-title u-text-r-l">'+G+'</h2><p class="u-layout-prose u-color-grey-90 u-text-p u-padding-r-all">'+H+"</p>";g.selection.setContent(node.outerHTML)}}var y=[],d,c;tinymce.each(["must","should","could","example"],function(D){if(!c){c=D}y.push({icon:"none icon-"+D,text:D.charAt(0).toUpperCase()+D.slice(1),context:"insert",onclick:function(){d=D;b(D)}})});g.addButton("ipa-callout",{icon:"none icon-callout",type:"splitbutton",title:"Callout",onclick:function(){b(d||c)},menu:y,stateSelector:"div.Callout"});C.push({icon:"none icon-callout",text:"Callout",context:"insert",onclick:function(){b(d||c)},menu:y});var n;var u=function(E,F){var D=E.settings.plugins?E.settings.plugins:"";return tinymce.util.Tools.inArray(D.split(/[ ,]/),F)!==-1};function k(D){return g.$.contains(g.getBody(),D)}function a(D){return D&&(/^(OL|UL|DL)$/).test(D.nodeName)&&k(D)}function B(E,D,G){function F(){var K,H,L={},I=0,J;H=g.dom.select("dt[data-mce-selected]");K=H[0];if(!K){K=g.selection.getStart()}if(G&&H.length>0){each(H,function(M){return L[M.parentNode.parentNode.nodeName]=1});each(L,function(M){I+=M});J=I!==1}else{J=!g.dom.getParent(K,D)}E.disabled(J);g.selection.selectorChanged(D,function(M){E.disabled(!M)})}if(g.initialized){F()}else{g.on("init",F)}}function A(){B(this,"dl.Accordion>dt:not([aria-selected=true])")}function m(){B(this,"dl.Accordion>dt[aria-selected=true]")}function v(F,D){var E=[];if(D){tinymce.util.Tools.each(D.split(/[ ,]/),function(G){E.push({text:G.replace(/\-/g," ").replace(/\b\w/g,function(H){return H.toUpperCase()}),data:G=="default"?"":G})});E.push({text:"-"});E.push({icon:"none icon-arrow-up",text:"Open",onclick:function(){g.undoManager.transact(function(){var G,I=g.dom,H=g.selection;G=I.getParent(H.getNode(),"dt");if(G&&G.nodeName=="DT"){I.setAttrib(G,"aria-selected","true")}})},onpostrender:A});E.push({icon:"none icon-arrow-down",text:"Close",onclick:function(){g.undoManager.transact(function(){var G,I=g.dom,H=g.selection;G=I.getParent(H.getNode(),"dt");if(G&&G.nodeName=="DT"){I.setAttrib(G,"aria-selected","")}})},onpostrender:m})}return E}var z="default,Accordion,Accordion--default,Accordion--plus,Timeline";n=v("DL",g.getParam("deflist_styles",z));function t(E,D){if(D==null){return}g.undoManager.transact(function(){var G,H=g.dom,F=g.selection;G=H.getParent(F.getNode(),"dl");if(!G||G.nodeName!=E||D===false){g.execCommand("InsertDefinitionList",false,null)}G=H.getParent(F.getNode(),"dl");if(G){tinymce.util.Tools.each(H.select("dl",G).concat([G]),function(I){if(I.nodeName!==E&&D!==false){I=H.rename(I,E)}tinymce.util.Tools.each(g.getParam("deflist_styles",z).split(/[ ,]/),function(J){H.removeClass(I,J)});if((D=="Accordion--default")||(D=="Accordion--plus")){H.addClass(I,"Accordion")}if(D!==""){H.addClass(I,D)}})}g.focus()})}function r(F){var G=g.dom,E=G.getParent(g.selection.getNode(),"dl");if(E){var D=null;F.control.items().each(function(H){H.active(false);if(H.settings.data){if(G.hasClass(E,H.settings.data)){D=H}}else{if(!D){D=H}}});D.active(true)}}var f=function(D){return function(){var E=this;g.on("NodeChange",function(G){var F=tinymce.util.Tools.grep(G.parents,a);E.active(F.length>0&&F[0].nodeName===D)})}};if(u(g,"lists")){g.addCommand("ApplyDefinitionListStyle",function(E,D){t("DL",false)});g.addButton("ipa-deflist",{type:(n.length>0)?"splitbutton":"button",tooltip:"Definition list",icon:"none icon-list-2",menu:n,onPostRender:f("DL"),onshow:r,onselect:function(D){t("DL",D.control.settings.data)},onclick:function(){t("DL",false)}});g.on("keyup",function(F){if(F.keyCode==13){var D,G=g.dom,E=g.selection;D=G.getParent(E.getNode(),"dt,dd");if(D){if(D.nodeName=="DT"){G.rename(D,"dd")}else{if(D.nodeName=="DD"){G.rename(D,"dt")}}}}})}g.addMenuItem("ipa",{icon:"none icon-ipa",text:"ItaliaPA",menu:C,context:"insert"});g.addButton("blockquote",{text:null,icon:"blockquote",tooltip:"Blockquote",onclick:function(){tinyMCE.activeEditor.selection.setContent('<blockquote class="Prose-blockquote"><p class="u-layout-prose u-color-grey-90 u-text-p u-padding-r-all">'+((text=tinyMCE.activeEditor.selection.getContent())?text:"Citazione")+"</p></blockquote>")}});g.addButton("codesample",{text:null,icon:"code",tooltip:"Code",onclick:function(){tinyMCE.activeEditor.selection.setContent('<pre class="u-textPreformatted u-textOverflow language-markup"><code class="u-text-r-xxs">'+((text=tinyMCE.activeEditor.selection.getContent())?text:"Codice")+"</code></pre>")}});g.on("init",function(){var D="p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table";g.settings.inline_styles=false;g.settings.table_default_attributes={"class":"Table Table--withBorder u-text-r-xs"};g.formatter.register({aligncenter:[{selector:D,classes:"u-textCenter"},{selector:"img",styles:{"max-width":"100%",height:"auto",display:"block","margin-left":"auto","margin-right":"auto"}}],alignleft:[{selector:D,classes:"u-textLeft"},{selector:"img",styles:{"max-width":"100%",height:"auto",display:"block","margin-left":"0","margin-right":"auto"}}],alignright:[{selector:D,classes:"u-textRight"},{selector:"img",styles:{"max-width":"100%",height:"auto",display:"block","margin-left":"auto","margin-right":"0"}}],h1:{block:"h1",classes:"u-text-h1",exact:true},h2:{block:"h2",classes:"u-text-h2",exact:true},h3:{block:"h3",classes:"u-text-h3",exact:true},h4:{block:"h4",classes:"u-text-h4",exact:true},h5:{block:"h5",classes:"u-text-h5",exact:true},h6:{block:"h6",classes:"u-text-h6",exact:true}})})});